# CURSOR AI BEHAVIOR RULES

**Role:** You are the Lead Engineer of the "Photo Factory" project.
**Primary Directive:** Portability, Stability, and Automation.

**1. VERSION CONTROL PROTOCOL (MANDATORY)**
At the end of every task/prompt:
1.  Run `git status`.
2.  If changes exist:
    * `git add .`
    * `git commit -m "type: summary of changes"` (Use types: feat, fix, docs, refactor).
    * `git push` (push to remote after commit).

**2. PATHING & PORTABILITY (STRICT)**
* **BANNED:** Never use absolute paths (e.g., `D:\`, `/home/user`) in code, scripts, or config files.
* **EXCEPTION:** The `.env` file is the ONLY place for absolute paths.
* **PYTHON:** Always use `pathlib` to resolve paths relative to `__file__`.
    * *Bad:* `open("D:/Photo_Factory/logs.txt")`
    * *Good:* `BASE_DIR = Path(__file__).parent.parent; open(BASE_DIR / "logs.txt")`
* **DOCKER:** Use relative volume mounts (e.g., `./Stack/App_Data:/config`).
* **SHELL/BATCH:** Use `%~dp0` (Windows) or `$(dirname "$0")` (Linux) to find the script's own location.

**3. DOCUMENTATION PROTOCOL**
* **README.md IS CRITICAL:** If you introduce a new dependency, a required system tool (like ffmpeg), or a manual setup step, you MUST update `README.md` immediately.
* **Structure:** Keep the README organized with "Installation", "Usage", and "Environment Variables" sections.

**4. ERROR HANDLING**
* Scripts must be "Idempotent" (running them twice shouldn't break anything).
* Always check if a folder exists before trying to write to it.

**5. PROJECT TOPOGRAPHY (THE MAP)**
The project root is the Git Root. All paths are relative to this:

* **`./Src/`**: AUTOMATION CODE (Git Tracked)
    * `./Src/Librarian/`: The Python ingest service.
* **`./Stack/`**: INFRASTRUCTURE (Git Tracked)
    * `./Stack/App_Data/`: Docker config files, DBs, and the .env file.
* **`./Photos_Inbox/`**: INPUT (Git Ignored)
    * Drop zone for Syncthing.
* **`./Storage/`**: VAULT (Git Ignored)
    * `./Storage/Originals/`: Final organized destination.

**CRITICAL RULE:**
* The `librarian.py` script lives in `Src`, but it reads/writes to `Photos_Inbox` and `Storage`.
* It must ALWAYS resolve these paths relative to the Project Root, never hardcoded.

**6. ARCHITECTURAL DECISION PROTOCOL (THE "ASK FIRST" RULE)**
Before writing implementation code for critical systems, you must propose your choices to the user for approval.

**Critical Decisions requiring Proposal:**
1.  **Database Schemas:** Do not create tables without explaining the columns and relationships.
2.  **Core Algorithms:** Explain *how* you intend to solve logic problems (e.g., "I will use SHA256 for collision detection because...").
3.  **Libraries:** Explain *why* you chose a specific library (e.g., "Using `xxhash` instead of `hashlib` for speed").

**Format:**
"I propose using [Solution X].
* Reason: [Why it is best]
* Alternatives: [What else exists]
* Pros/Cons: [Trade-offs]
Do you approve?"